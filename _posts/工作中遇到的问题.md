---
layout:     post
title:      工作中遇到的问题
subtitle:   
date:       2019-12-24
author:     sugar-foxs
catalog: 	true
tags:
    - java
    - spring
---

本文主要记录和分享一些工作中遇到的问题。
<!-- more -->

# spring事务传播的问题
> 问题描述:在一个事务中查询一个之前创建的数据行为空，查mysql这个数据行是存在的。
- 经debug之后知道创建数据行的操作调用的新的类里的方法，该方法新起了一个REQUIRES_NEW事务。因为REQUIRES_NEW新建的事务是独立于当前事务的，又因为数据库默认隔离级别是可重复读，所以在当前事务查询REQUIRES_NEW新建的独立事务中新建的数据行，是看不到变化的。所以查询结果是null。
- 解决方法：需要查询的新建数据行的方法也在一个REQUIRES_NEW事务中，这样能保证查询到数据。

> 下面分别介绍下spring事务传播机制和mysql事务隔离级别

## spring事务传播机制
见{% post_link spring事务传播机制 %}

## mysql事务隔离级别
见{% post_link mysql事务隔离级别 %}

# java-stream-toMap报重复键问题
- 问题描述：java stream API的toMap方法，当遇到重复键时，会报Duplicate key错误。
- 解决方法：在toMap方法中增加一个BinaryOperator作为第三个参数，表示遇到重复键时，进行哪种操作，可以选择旧值或者新值，也可以对旧值和新值进行一些转换作为最终的值。

