---
layout:     post
title:      设计模式在工作中的应用
subtitle:   
date:       2020-03-24
author:     sugar-foxs
catalog: 	true
tags:
    - java
    - 设计模式
---

设计模式的本质是面向对象设计原则的实际运用，是对类的封装性、继承性和多态性，以及类的关联关系和组合关系的充分理解。本文记录策略模式和模板方法模式在工作中的应用。
<!-- more -->

在应用中需要处理不同的模型：单表模型，星型模型，雪花模型，星座模型等等。不同的模型对应着不同的生成sql的逻辑。这时策略模式便可以很好的处理这种情况，并具有很好的扩展性。

- 将不同策略的单例放到map中，后面根据不同的模型类型modelType获取模型策略。
```java
@Component
public class ModelStrategyResolver implements InitializingBean, ApplicationContextAware {
    private ApplicationContext applicationContext;

    private Map<Integer, AbstractModelStrategy> modelStrategyHandlerMap = new HashMap<>();

    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        this.applicationContext = applicationContext;
    }

    @Override
    public void afterPropertiesSet() {
        Map<String, AbstractModelStrategy> beanMap = applicationContext.getBeansOfType(AbstractModelStrategy.class);
        for (String key : beanMap.keySet()) {
            this.modelStrategyHandlerMap.put(beanMap.get(key).modelType(), beanMap.get(key));
        }
    }

    public AbstractModelStrategy getHandler(Integer modelType) {
        return modelStrategyHandlerMap.get(modelType);
    }
}
```

- 模型策略的抽象类
```java
public abstract class AbstractModelStrategy{

    public abstract Integer modelType();

    public abstract String generateSql();
}
```
- 这里的generateSql方法如果有固定的模板，可以使用模板方法模式，抽象出算法骨架。

- 单表模型策略
```java
@Component
public class SingleModelModelStrategy extends CommonStrategy {
    @Autowired
    private PublishTableService publishTableService;
    @Autowired
    private ColumnService columnService;
    @Autowired
    private PublishModelService publishModelService;

    @Override
    public Integer modelType() {
        return ModelTypeEnum.SINGLE_MODEL.id;
    }

    public String generateSql(){
        // ...
    }
}
```

- 星型模型策略
```java
@Component
public class StarModelModelStrategy extends CommonStrategy {
    @Override
    public Integer modelType() {
        return ModelTypeEnum.STAR_MODEL.id;
    }

    public String generateSql(){
        // ...
    }

}
```

- 之后再扩展其他的策略就会很方便。
